#!/bin/bash

# Encerramento
trap "exit 1" INT

# Define o IP alvo onde o "Port Knocking" será feito
ip="37.59.174.235"

# Define a sequência de portas que precisam receber pacotes SYN
portas=(13 37 30000 3000)


apres()
{
        clear
        echo -e "\033[01;31m"
        echo "
  _____      _               _____                      _ _          ___   ___   ___   ___  
 / ____|    | |             / ____|                    (_) |        / _ \ / _ \ / _ \ / _ \ 
| |    _   _| |__   ___ _ _| (___   ___  ___ _   _ _ __ _| |_ _   _| | | | | | | | | | | | |
| |   | | | | '_ \ / _ \ '__\___ \ / _ \/ __| | | | '__| | __| | | | | | | | | | | | | | | |
| |___| |_| | |_) |  __/ |  ____) |  __/ (__| |_| | |  | | |_| |_| | |_| | |_| | |_| | |_| |
 \_____\__, |_.__/ \___|_| |_____/ \___|\___|\__,_|_|  |_|\__|\__, |\___/ \___/ \___/ \___/ 
        __/ |                                                  __/ |                        
       |___/                                                  |___/                 
       
       Exploit - Port Knocking"

        echo -e "\033[00;00m"
}


buscando()
{
        echo -e "\033[01;32m"
        echo -e "###########################################"
        echo -e "|->          Ativando Portas...         <-|"
        echo -e "###########################################"
        echo -e "\033[00;00m"
}


# Exibe o banner de apresentação
apres

# Exibe mensagem de início
buscando

# Loop: percorre cada porta do array na ORDEM CERTA
for i in ${portas[@]}
do
	# Envia UM pacote TCP SYN para cada porta
	# -c 1 	→ envia só 1 pacote
	# --syn → flag SYN
	# -p    → define a porta
	hping3 -c 1 --syn -p $i $ip 1>/dev/null 2>&1

	# Mostra na tela qual porta está sendo “batida”
	echo "# Enviando pacote Syn na porta $i"
done

# Depois do knocking correto, a porta 1337 deve abrir, aqui tentamos acessar o socket
wget -q --no-verbose $ip:1337 -O index.html 2>/dev/null

echo -e "\n--------------------------------------------------------------------------------------------------"

# Mostra o conteúdo do index.html recebido, mas remove linhas com <br> e <hr> para ficar limpo
cat index.html 2>/dev/null | grep -Ev "<br>|<hr>"

# Remove o arquivo baixado para não deixar rastro
rm index.html 2>/dev/null

echo -e "--------------------------------------------------------------------------------------------------"
